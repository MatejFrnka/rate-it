<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <title th:if="${interest.id == null}" th:text="'Rate-It: New Interest'"></title>
    <title th:unless="${interest.id != null}" th:text="'Rate-It: Edit ' + ${interest.name}"></title>
</head>
<body>

<form th:object="${interest}" th:data-interest-id="*{id}" name="myForm" onsubmit="return onSubmitForm();">
<!--<form name="myform" th:if="${interest.id == null}" th:action="@{/interests/create}" th:method="post">-->
<!--<form th:unless="${interest.id == null}" th:action="@{/interests/{id}/edit(id=${interest.id})}" th:method="put">-->
    <label>Name:
        <input type="text" name="name" th:value="*{name}" th:frequired>
    </label>
    <br>

    <label>Description:
        <textarea name="description" th:field="*{description}"></textarea>
    </label>
    <br>

    <!--todo: add checkbox for exclusivity-->

<!--    <label>Criteria:-->
<!--        <input type="text" name="criteria" required>-->
<!--    </label>-->
<!--    <br>-->

    <div id="criteriaContainer" class="criteria-container">Criteria:
        <!-- Check if the form is in editing mode -->
        <th:block th:if="*{id != null}">
            <!-- Iterate over existing criteria and add them to the container -->
            <div th:each="criterion : ${interest.criteria}">
                <div>
                        <input type="text" name="criteria" th:value="${criterion.name}" />
                        <button type="button" onclick="removeCriteria(this)">Remove</button>
                </div>
            </div>
        </th:block>
    </div>

    <button type="button" onclick="addCriteria()">More Criteria</button>

    <br>
    <button type="submit">Save</button>
</form>

<script th:inline="javascript">
    function onSubmitForm()
    {
        var interestId = document.myForm.getAttribute('id');
        if(interestId == null)
        {
            document.myForm.action = "@{/interests/create}";
            document.myForm.method = "post";
        }
        else
        {
            document.myForm.action = "@{/interests/{id}/edit(id=${interest.id})}";
            document.myForm.method = "put";
        }
        return true;
    }

    function addCriteria() {
        var criteriaContainer = document.getElementById('criteriaContainer');
        var div = document.createElement('div');
        var input = document.createElement('input');
        var removeButton = document.createElement('button');

        input.type = 'text';
        input.name = 'criteria';

        removeButton.type = 'button';
        removeButton.textContent = 'Remove';
        removeButton.onclick = function () {
            criteriaContainer.removeChild(div);
        };

        div.appendChild(input);
        div.appendChild(removeButton);
        criteriaContainer.appendChild(div);
    }

    function removeCriteria(button) {
        var parentDiv = button.closest('div');
        if (parentDiv) {
            parentDiv.remove();
        }
    }
</script>

</body>
</html>